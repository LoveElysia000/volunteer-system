syntax = "proto3";

package activity;

import "google/api/annotations.proto";
import "google/api/client.proto";

option go_package = "volunteer-system/internal/api;api";

// 活动管理服务端接口
service ActivityService {
  option (google.api.default_host) = "0.0.0.0:8080";

  // 获取活动列表
  rpc ActivityList(ActivityListRequest) returns (ActivityListResponse) {
    option (google.api.http) = {
      post: "/api/activities"
    };
  }

  // 活动报名
  rpc ActivitySignup(ActivitySignupRequest) returns (ActivitySignupResponse) {
    option (google.api.http) = {
      post: "/api/activities/signup"
      body: "*"
    };
  }

  // 取消报名
  rpc ActivityCancel(ActivityCancelRequest) returns (ActivityCancelResponse) {
    option (google.api.http) = {
      post: "/api/activities/cancel"
      body: "*"
    };
  }

  // 活动签到（志愿者侧）
  rpc ActivityCheckIn(ActivityCheckInRequest) returns (ActivityCheckInResponse) {
    option (google.api.http) = {
      post: "/api/activities/checkin"
      body: "*"
    };
  }

  // 活动签退（志愿者侧，签退后触发工时结算）
  rpc ActivityCheckOut(ActivityCheckOutRequest) returns (ActivityCheckOutResponse) {
    option (google.api.http) = {
      post: "/api/activities/checkout"
      body: "*"
    };
  }

  // 获取活动详情
  rpc ActivityDetail(ActivityDetailRequest) returns (ActivityDetailResponse) {
    option (google.api.http) = {
      get: "/api/activities/:id"
    };
  }

  // 获取我的活动列表
  rpc MyActivities(MyActivitiesRequest) returns (MyActivitiesResponse) {
    option (google.api.http) = {
      post: "/api/activities/my"
    };
  }

  // ========== 组织端活动管理 ==========

  // 创建活动
  rpc CreateActivity(CreateActivityRequest) returns (CreateActivityResponse) {
    option (google.api.http) = {
      post: "/api/activities/create"
      body: "*"
    };
  }

  // 更新活动
  rpc UpdateActivity(UpdateActivityRequest) returns (UpdateActivityResponse) {
    option (google.api.http) = {
      put: "/api/activities/:id"
      body: "*"
    };
  }

  // 删除活动
  rpc DeleteActivity(DeleteActivityRequest) returns (DeleteActivityResponse) {
    option (google.api.http) = {
      delete: "/api/activities/:id"
    };
  }

  // 取消活动
  rpc CancelActivity(CancelActivityRequest) returns (CancelActivityResponse) {
    option (google.api.http) = {
      post: "/api/activities/cancel/:id"
      body: "*"
    };
  }

  // 完结活动
  rpc FinishActivity(FinishActivityRequest) returns (FinishActivityResponse) {
    option (google.api.http) = {
      post: "/api/activities/finish/:id"
      body: "*"
    };
  }

  // 生成签到码/签退码（组织侧）
  rpc GenerateAttendanceCodes(GenerateAttendanceCodesRequest) returns (GenerateAttendanceCodesResponse) {
    option (google.api.http) = {
      post: "/api/activities/attendance-codes/generate/:id"
      body: "*"
    };
  }

  // 重置签到码/签退码（组织侧）
  rpc ResetAttendanceCode(ResetAttendanceCodeRequest) returns (ResetAttendanceCodeResponse) {
    option (google.api.http) = {
      post: "/api/activities/attendance-codes/reset/:id"
      body: "*"
    };
  }

  // 查询活动签到码/签退码（组织侧）
  rpc GetActivityAttendanceCodes(GetActivityAttendanceCodesRequest) returns (GetActivityAttendanceCodesResponse) {
    option (google.api.http) = {
      get: "/api/activities/attendance-codes/:id"
    };
  }

  // 活动签到签退补录（组织侧）
  rpc ActivitySupplementAttendance(ActivitySupplementAttendanceRequest) returns (ActivitySupplementAttendanceResponse) {
    option (google.api.http) = {
      post: "/api/activities/supplement-attendance"
      body: "*"
    };
  }
}

// ========== 活动列表 ==========

message ActivityListRequest {
  // 页码 可选 @gotags: query:"page"
  int32 page = 1;
  // 页大小 可选 @gotags: query:"pageSize"
  int32 pageSize = 2;
  // 状态筛选 可选 @gotags: query:"status"
  int32 status = 3;
}

message ActivityListResponse {
  int32 total = 1;
  repeated ActivityItem list = 2;
}

message ActivityItem {
  int64 id = 1;
  // 活动标题
  string title = 2;
  // 活动描述
  string description = 3;
  // 封面图URL
  string coverUrl = 4;
  // 开始时间
  string startTime = 5;
  // 结束时间
  string endTime = 6;
  // 地点名称
  string location = 7;
  // 预估工时
  double duration = 8;
  // 最大招募人数
  int32 maxPeople = 9;
  // 当前已报名人数
  int32 currentPeople = 10;
  // 状态: 1-报名中, 2-已结束, 3-已取消
  int32 status = 11;
  // 是否已报名 (当前用户)
  bool isRegistered = 12;
  // 是否已满员
  bool isFull = 13;
}

// ========== 活动报名 ==========

message ActivitySignupRequest {
  // 活动ID 必填 @gotags: json:"activityId,required"
  int64 activityId = 1;
}

message ActivitySignupResponse {
  // 报名成功
  bool success = 1;
}

// ========== 取消报名 ==========

message ActivityCancelRequest {
  // 活动ID 必填 @gotags: json:"activityId,required"
  int64 activityId = 1;
}

message ActivityCancelResponse {
  // 取消成功
  bool success = 1;
}

// ========== 活动签到签退 ==========

message ActivityCheckInRequest {
  // 活动ID 必填 @gotags: json:"activityId,required"
  int64 activityId = 1;
  // 签到码 必填 @gotags: json:"checkInCode,required"
  string checkInCode = 2;
}

message ActivityCheckInResponse {
  // 是否成功
  bool success = 1;
  // 签到时间
  string checkInTime = 2;
}

message ActivityCheckOutRequest {
  // 活动ID 必填 @gotags: json:"activityId,required"
  int64 activityId = 1;
  // 签退码 必填 @gotags: json:"checkOutCode,required"
  string checkOutCode = 2;
}

message ActivityCheckOutResponse {
  // 是否成功
  bool success = 1;
  // 签退时间
  string checkOutTime = 2;
  // 本次发放工时
  double grantedHours = 3;
}

message ActivitySupplementAttendanceRequest {
  // 活动ID 必填 @gotags: json:"activityId,required"
  int64 activityId = 1;
  // 志愿者ID（volunteers.id）必填 @gotags: json:"volunteerId,required"
  int64 volunteerId = 2;
  // 补录签到时间（当原记录未签到时必填）格式: 2006-01-02 15:04:05 @gotags: json:"checkInTime"
  string checkInTime = 3;
  // 补录签退时间 必填 格式: 2006-01-02 15:04:05 @gotags: json:"checkOutTime,required"
  string checkOutTime = 4;
  // 补录原因 可选 @gotags: json:"reason"
  string reason = 5;
}

message ActivitySupplementAttendanceResponse {
  // 是否成功
  bool success = 1;
  // 补录后的签到时间
  string checkInTime = 2;
  // 补录后的签退时间
  string checkOutTime = 3;
  // 本次发放工时
  double grantedHours = 4;
}

// ========== 活动详情 ==========

message ActivityDetailRequest {
  // 活动ID 必填 @gotags: path:"id,required"
  int64 id = 1;
}

message ActivityDetailResponse {
  ActivityInfo activity = 1;
}

message ActivityInfo {
  int64 id = 1;
  // 组织ID
  int64 orgId = 2;
  // 组织名称
  string orgName = 3;
  // 活动标题
  string title = 4;
  // 活动描述
  string description = 5;
  // 封面图URL
  string coverUrl = 6;
  // 开始时间
  string startTime = 7;
  // 结束时间
  string endTime = 8;
  // 地点名称
  string location = 9;
  // 详细地址
  string address = 10;
  // 预估工时
  double duration = 11;
  // 最大招募人数
  int32 maxPeople = 12;
  // 当前已报名人数
  int32 currentPeople = 13;
  // 状态: 1-报名中, 2-已结束, 3-已取消
  int32 status = 14;
  // 是否已报名 (当前用户)
  bool isRegistered = 15;
  // 创建时间
  string createdAt = 16;
  // 签到状态: 0-未签到, 1-已签到
  int32 checkInStatus = 17;
  // 签到时间
  string checkInTime = 18;
  // 签退状态: 0-未签退, 1-已签退
  int32 checkOutStatus = 19;
  // 签退时间
  string checkOutTime = 20;
  // 工时结算状态: 0-未结算, 1-已发放, 2-已作废
  int32 workHourStatus = 21;
  // 本次发放工时
  double grantedHours = 22;
}

// ========== 我的活动 ==========

message MyActivitiesRequest {
  // 页码 可选 @gotags: query:"page"
  int32 page = 1;
  // 页大小 可选 @gotags: query:"pageSize"
  int32 pageSize = 2;
  // 状态筛选 可选 @gotags: query:"status"
  // 1-报名中, 2-已结束, 3-已取消
  int32 status = 3;
}

message MyActivitiesResponse {
  int32 total = 1;
  repeated MyActivityItem list = 2;
}

message MyActivityItem {
  int64 id = 1;
  // 组织ID
  int64 orgId = 2;
  // 组织名称
  string orgName = 3;
  // 活动标题
  string title = 4;
  // 活动描述
  string description = 5;
  // 封面图URL
  string coverUrl = 6;
  // 开始时间
  string startTime = 7;
  // 结束时间
  string endTime = 8;
  // 地点名称
  string location = 9;
  // 预估工时
  double duration = 10;
  // 最大招募人数
  int32 maxPeople = 11;
  // 当前已报名人数
  int32 currentPeople = 12;
  // 状态: 1-报名中, 2-已结束, 3-已取消
  int32 status = 13;
  // 报名时间
  string signupTime = 14;
  // 签到状态: 0-未签到, 1-已签到
  int32 checkInStatus = 15;
  // 签到时间
  string checkInTime = 16;
  // 签退状态: 0-未签退, 1-已签退
  int32 checkOutStatus = 17;
  // 签退时间
  string checkOutTime = 18;
  // 工时结算状态: 0-未结算, 1-已发放, 2-已作废
  int32 workHourStatus = 19;
  // 本次发放工时
  double grantedHours = 20;
}

// ========== 组织端活动管理 ==========

// CreateActivityRequest 创建活动请求
message CreateActivityRequest {
  // 组织ID 必填 @gotags: json:"orgId,required"
  int64 orgId = 1;
  // 活动标题 必填 @gotags: json:"title,required"
  string title = 2;
  // 活动描述 可选 @gotags: json:"description"
  string description = 3;
  // 封面图URL 可选 @gotags: json:"coverUrl"
  string coverUrl = 4;
  // 开始时间 必填 @gotags: json:"startTime,required"
  string startTime = 5;
  // 结束时间 必填 @gotags: json:"endTime,required"
  string endTime = 6;
  // 地点名称 必填 @gotags: json:"location,required"
  string location = 7;
  // 详细地址 可选 @gotags: json:"address"
  string address = 8;
  // 预估工时（小时） 必填 @gotags: json:"duration,required"
  double duration = 9;
  // 最大招募人数（0表示不限） 必填 @gotags: json:"maxPeople,required"
  int32 maxPeople = 10;
}

// CreateActivityResponse 创建活动响应
message CreateActivityResponse {
  // 活动ID
  int64 id = 1;
  // 消息
  string message = 2;
}

// UpdateActivityRequest 更新活动请求
message UpdateActivityRequest {
  // 活动ID 必填 @gotags: path:"id,required"
  int64 id = 1;
  // 活动标题 可选 @gotags: json:"title"
  string title = 2;
  // 活动描述 可选 @gotags: json:"description"
  string description = 3;
  // 封面图URL 可选 @gotags: json:"coverUrl"
  string coverUrl = 4;
  // 开始时间 可选 @gotags: json:"startTime"
  string startTime = 5;
  // 结束时间 可选 @gotags: json:"endTime"
  string endTime = 6;
  // 地点名称 可选 @gotags: json:"location"
  string location = 7;
  // 详细地址 可选 @gotags: json:"address"
  string address = 8;
  // 预估工时（小时） 可选 @gotags: json:"duration"
  double duration = 9;
  // 最大招募人数（0表示不限） 可选 @gotags: json:"maxPeople"
  int32 maxPeople = 10;
}

// UpdateActivityResponse 更新活动响应
message UpdateActivityResponse {
  // 消息
  string message = 1;
}

// DeleteActivityRequest 删除活动请求
message DeleteActivityRequest {
  // 活动ID 必填 @gotags: path:"id,required"
  int64 id = 1;
}

// DeleteActivityResponse 删除活动响应
message DeleteActivityResponse {
  // 消息
  string message = 1;
}

// CancelActivityRequest 取消活动请求
message CancelActivityRequest {
  // 活动ID 必填 @gotags: path:"id,required"
  int64 id = 1;
  // 取消原因 可选 @gotags: json:"reason"
  string reason = 2;
}

// CancelActivityResponse 取消活动响应
message CancelActivityResponse {
  // 消息
  string message = 1;
}

// FinishActivityRequest 完结活动请求
message FinishActivityRequest {
  // 活动ID 必填 @gotags: path:"id,required"
  int64 id = 1;
}

// FinishActivityResponse 完结活动响应
message FinishActivityResponse {
  // 消息
  string message = 1;
}

// GenerateAttendanceCodesRequest 生成签到码/签退码请求
message GenerateAttendanceCodesRequest {
  // 活动ID 必填 @gotags: path:"id,required"
  int64 id = 1;
  // 签到码有效时长（分钟）可选，<=0 表示不过期 @gotags: json:"checkInValidMinutes"
  int32 checkInValidMinutes = 2;
  // 签退码有效时长（分钟）可选，<=0 表示不过期 @gotags: json:"checkOutValidMinutes"
  int32 checkOutValidMinutes = 3;
}

// GenerateAttendanceCodesResponse 生成签到码/签退码响应
message GenerateAttendanceCodesResponse {
  // 是否成功
  bool success = 1;
  // 本次生成的签到码
  string checkInCode = 2;
  // 本次生成的签退码
  string checkOutCode = 3;
  // 当前码版本号
  int64 attendanceCodeVersion = 4;
  // 码更新时间
  string attendanceCodeUpdatedAt = 5;
  // 签到码过期时间（为空表示不过期）
  string checkInExpireAt = 6;
  // 签退码过期时间（为空表示不过期）
  string checkOutExpireAt = 7;
}

// ResetAttendanceCodeRequest 重置签到码/签退码请求
message ResetAttendanceCodeRequest {
  // 活动ID 必填 @gotags: path:"id,required"
  int64 id = 1;
  // 重置码类型（1-签到码，2-签退码）必填 @gotags: json:"codeType,required"
  int32 codeType = 2;
  // 码有效时长（分钟）可选，<=0 表示不过期 @gotags: json:"validMinutes"
  int32 validMinutes = 3;
}

// ResetAttendanceCodeResponse 重置签到码/签退码响应
message ResetAttendanceCodeResponse {
  // 是否成功
  bool success = 1;
  // 重置码类型（1-签到码，2-签退码）
  int32 codeType = 2;
  // 本次重置后的码
  string code = 3;
  // 本次重置后的码过期时间（为空表示不过期）
  string expireAt = 4;
  // 当前码版本号
  int64 attendanceCodeVersion = 5;
  // 码更新时间
  string attendanceCodeUpdatedAt = 6;
}

// GetActivityAttendanceCodesRequest 查询活动签到码/签退码请求
message GetActivityAttendanceCodesRequest {
  // 活动ID 必填 @gotags: path:"id,required"
  int64 id = 1;
}

// GetActivityAttendanceCodesResponse 查询活动签到码/签退码响应
message GetActivityAttendanceCodesResponse {
  // 是否成功
  bool success = 1;
  // 当前签到码
  string checkInCode = 2;
  // 当前签退码
  string checkOutCode = 3;
  // 签到码过期时间（为空表示不过期）
  string checkInExpireAt = 4;
  // 签退码过期时间（为空表示不过期）
  string checkOutExpireAt = 5;
  // 当前码版本号
  int64 attendanceCodeVersion = 6;
  // 码更新时间
  string attendanceCodeUpdatedAt = 7;
}
